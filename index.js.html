<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>index.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Payworks.html">Payworks</a><ul class='methods'><li data-type='method'><a href="Payworks.html#auth">auth</a></li><li data-type='method'><a href="Payworks.html#cancel">cancel</a></li><li data-type='method'><a href="Payworks.html#close">close</a></li><li data-type='method'><a href="Payworks.html#closeGroup">closeGroup</a></li><li data-type='method'><a href="Payworks.html#forceAuth">forceAuth</a></li><li data-type='method'><a href="Payworks.html#postAuth">postAuth</a></li><li data-type='method'><a href="Payworks.html#preAuth">preAuth</a></li><li data-type='method'><a href="Payworks.html#reactivate">reactivate</a></li><li data-type='method'><a href="Payworks.html#reAuth">reAuth</a></li><li data-type='method'><a href="Payworks.html#refund">refund</a></li><li data-type='method'><a href="Payworks.html#request">request</a></li><li data-type='method'><a href="Payworks.html#reverse">reverse</a></li><li data-type='method'><a href="Payworks.html#suspend">suspend</a></li><li data-type='method'><a href="Payworks.html#verify">verify</a></li></ul></li><li><a href="PromiseEmitter.html">PromiseEmitter</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">index.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const co = require('co')
const EventEmitter = require('events')
const request = require('./utils').request
const validate = require('./utils').validate
const joi = require('joi')
const PromiseEmitter = require('./utils/promiseEmitter')

/**
 * @class
 *
 * @param {Object} options
 */
class Payworks extends EventEmitter {
  constructor (options) {
    super()
    options = options || {}
    this.user = options.user
    this.password = options.password
    this.merchant_id = options.merchant
    this.terminal_id = options.terminal
    this.default = {}
    this.user &amp;&amp; (this.default.user = this.user)
    this.password &amp;&amp; (this.default.password = this.password)
    this.merchant_id &amp;&amp; (this.default.merchant_id = this.merchant_id)
    this.terminal_id &amp;&amp; (this.default.terminal_id = this.terminal_id)
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  auth (params, options, callback) {}

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  forceAuth (params, options, callback) {}

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  preAuth (params, options, callback) {
    let schema = {
      amount: joi.number().required(),
      reference: joi.string(),
      entry_mode: joi.string().max(20).required(),
      card_number: joi.string().max(20).required(),
      card_exp: joi.string().max(4).required(),
      security_code: joi.string().max(4).required()
    }

    return Payworks.request.call(this, schema, params, options, callback)
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  postAuth (params, options, callback) {}

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  reAuth (params, options, callback) {}

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  refund (params, options, callback) {}

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  cancel (params, options, callback) {

  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  reverse (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  close (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  closeGroup (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  verify (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  suspend (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }

  /**
   * This is a description
   *
   * @public
   *
   * @param {Object} params
   * @param {(Object|Function|undefined)} options
   * @param {(Function|undefined)} callback
   *
   * @return {EventEmitter}
   */
  reactivate (params, options, callback) {
    let e = new PromiseEmitter(function (resolve, reject) {
      co(function * () {
        yield validate(params, {
          amount: joi.number().required()
        })
        return yield request({
          cmd_trans: 'PREAUTH',
          user: this.username,
          password: this.password,
          merchant_id: this.merchant
        })
      })
        .then(function (resRequest) {
          e.emit('resolve', resRequest)
          if (typeof callback === 'function') {
            resolve(callback(null, resRequest))
            return
          }
          resolve(resRequest)
        })
        .catch(function (error) {
          e.emit('error', error)
          if (typeof callback === 'function') {
            reject(callback(error, null))
            return
          }
          reject(error)
        })
    })
    return e
  }
}

/**
 * Helper function to make request to Payworks. Works with coroutines or events and promises.
 * Supports schema validation and emits events depending on response.
 *
 * @static
 * @method Payworks#request
 *
 * @param {Object} schema
 * @param {Object} params
 * @param {(Object|function|undefined)} options
 * @param {(function|undefined)} callback
 *
 * @return {PromiseEmitter}
 */
Payworks.request = require('./request')

module.exports = Payworks
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sat May 07 2016 01:20:49 GMT-0500 (CDT) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
